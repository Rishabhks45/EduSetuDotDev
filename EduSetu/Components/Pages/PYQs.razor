@page "/pyqs"
@using System.ComponentModel.DataAnnotations
@using EduSetu.Components.Shared
@inject NavigationManager NavigationManager

<div class="min-h-screen bg-gray-50 dark:bg-gray-950 pt-16">
    <div class="container mx-auto px-4 py-8 flex flex-col lg:flex-row gap-8">
        <div class="w-full lg:w-64 bg-white dark:bg-gray-900 rounded-lg shadow-sm p-6">
            <h2 class="text-xl font-semibold text-gray-800 dark:text-gray-100 mb-6">
                Browse Categories
            </h2>

            <div class="space-y-3">
                @foreach (var category in categories)
                {
                    <button @onclick="() => SelectCategory(category.Id)"
                            class="@($"w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors {(selectedCategory == category.Id ? "bg-primary-50 dark:bg-sky-800 text-primary-700 dark:text-sky-200 border border-primary-200 dark:border-sky-600" : "hover:bg-gray-50 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300 border border-transparent")}")">
                        @if (category.Id == "board")
                        {
                            <svg class="w-5 h-5 dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                            </svg>
                        }
                        else if (category.Id == "university")
                        {
                            <svg class="w-5 h-5 dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                            </svg>
                        }
                        else if (category.Id == "exam")
                        {
                            <svg class="w-5 h-5 dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path>
                            </svg>
                        }
                        else if (category.Id == "state")
                        {
                            <svg class="w-5 h-5 dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                        }
                        <span class="font-medium">@category.Name</span>
                    </button>
                }
            </div>

            @if (!string.IsNullOrEmpty(selectedCategory))
            {
                <div class="mt-8 p-4 bg-gray-50 dark:bg-gray-950 rounded-lg">
                    <h3 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Selected Category
                    </h3>
                    <div class="flex items-center gap-2">
                        @if (selectedCategory == "board")
                        {
                            <svg class="w-4 h-4 text-primary-600 dark:text-sky-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                            </svg>
                        }
                        else if (selectedCategory == "university")
                        {
                            <svg class="w-4 h-4 text-primary-600 dark:text-sky-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                            </svg>
                        }
                        else if (selectedCategory == "exam")
                        {
                            <svg class="w-4 h-4 text-primary-600 dark:text-sky-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path>
                            </svg>
                        }
                        else if (selectedCategory == "state")
                        {
                            <svg class="w-4 h-4 text-primary-600 dark:text-sky-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                        }
                        <span class="text-sm text-primary-700 dark:text-sky-200 font-medium">
                            @categories.FirstOrDefault(c => c.Id == selectedCategory)?.Name
                        </span>
                    </div>
                    <button @onclick="ClearCategorySelection"
                            class="mt-2 text-xs text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200">
                        Clear selection
                    </button>
                </div>
            }
        </div>

        <div class="flex-1">
            <div class="bg-white dark:bg-gray-900 rounded-lg shadow-sm p-6">
                <h1 class="text-2xl font-bold text-gray-800 dark:text-gray-100 mb-6">
                    Previous Year Questions
                </h1>

                <div class="space-y-4 mb-8">
                    <div class="relative">
                        <input type="text" placeholder="Search subjects..."
                               @bind-value="searchQuery" @bind-value:event="oninput"
                               class="w-full pl-10 pr-4 py-3 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary-500 dark:focus:ring-sky-500 focus:border-primary-500 dark:focus:border-sky-500 transition-colors bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400" />
                        <svg class="absolute left-3 top-3.5 text-gray-400 dark:text-gray-500 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </div>

                    @if (!string.IsNullOrEmpty(selectedCategory) && GetActiveFilters().Any())
                    {
                        <div class="bg-gray-50 dark:bg-gray-950 p-4 rounded-lg border border-gray-200 dark:border-gray-800">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center gap-2">
                                    <svg class="w-4 h-4 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.207A1 1 0 013 6.5V4z"></path>
                                    </svg>
                                    <h3 class="font-medium text-gray-800 dark:text-gray-100">Filters</h3>
                                </div>
                                <button @onclick="ClearFilters"
                                        class="text-primary-600 dark:text-sky-400 hover:text-primary-700 dark:hover:text-sky-300 font-medium">
                                    Clear All
                                </button>
                            </div>

                            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                                @foreach (var filterType in GetActiveFilters())
                                {
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                                            @GetFilterLabel(filterType)
                                        </label>
                                        <select @bind="filters[filterType]" @bind:after="() => StateHasChanged()"
                                                class="w-full p-2 border border-gray-300 dark:border-gray-700 rounded-md focus:ring-2 focus:ring-primary-500 dark:focus:ring-sky-500 focus:border-primary-500 dark:focus:border-sky-500 text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100">
                                            <option value="">All @GetFilterLabel(filterType)s</option>
                                            @if (filterOptions.ContainsKey(filterType))
                                            {
                                                @foreach (var option in filterOptions[filterType])
                                                {
                                                    <option value="@option">@option</option>
                                                }
                                            }
                                        </select>
                                    </div>
                                }
                            </div>

                            @if (filters.Any(f => !string.IsNullOrEmpty(f.Value)))
                            {
                                <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-800">
                                    <div class="flex flex-wrap gap-2">
                                        @foreach (var filter in filters)
                                        {
                                            @if (!string.IsNullOrEmpty(filter.Value))
                                            {
                                                <span class="inline-flex items-center gap-1 px-3 py-1 bg-primary-100 dark:bg-sky-800 text-primary-800 dark:text-sky-200 text-sm rounded-full">
                                                    @GetFilterLabel(filter.Key): @filter.Value
                                                    <button @onclick="() => ClearFilter(filter.Key)"
                                                            class="ml-1 hover:text-primary-900 dark:hover:text-sky-100">
                                                        ×
                                                    </button>
                                                </span>
                                            }
                                        }
                                    </div>
                                </div>
                            }
                        </div>
                    }
                </div>

                <div class="mb-6">
                    <p class="text-gray-600 dark:text-gray-400">
                        @filteredSubjects.Count @(filteredSubjects.Count == 1 ? "result" : "results") found
                        @if (!string.IsNullOrEmpty(selectedCategory))
                        {
                            <span class="ml-2 px-2 py-1 bg-primary-100 dark:bg-sky-800 text-primary-800 dark:text-sky-200 text-sm rounded">
                                @(char.ToUpper(selectedCategory[0]) + selectedCategory.Substring(1)) Wise
                            </span>
                        }
                    </p>
                </div>

                @if (filteredSubjects.Any())
                {
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        @foreach (var subject in filteredSubjects)
                        {
                            <SubjectCard Subject="subject" OnViewPapers="HandleViewPapers" />
                        }
                    </div>
                }
                else
                {
                    <div class="text-center py-12">
                        <div class="text-gray-400 dark:text-gray-600 mb-4">
                            <svg class="w-12 h-12 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                        </div>
                        <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-2">No results found</h3>
                        <p class="text-gray-600 dark:text-gray-400 mb-4">
                            Try adjusting your search terms or filters to find what you"re looking for.
                        </p>
                        @if (filters.Any(f => !string.IsNullOrEmpty(f.Value)))
                        {
                            <button @onclick="ClearFilters"
                                    class="text-primary-600 dark:text-sky-400 hover:text-primary-700 dark:hover:text-sky-300 font-medium">
                                Clear all filters
                            </button>
                        }
                    </div>
                }
            </div>
        </div>
    </div>
</div>